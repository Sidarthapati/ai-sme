{
  "id": "confluence_display_KAFKA_Dynamic+Topic+Config",
  "title": "Dynamic Topic Config - Apache Kafka - Apache Software Foundation",
  "content": "Currently we maintain per-topic configuration in our server.properties configuration file. This unfortunately requires bouncing the server every time you make a change. This wiki is a proposal for making some of these configurations dynamic.\nScope\nThe proposed scope is just for per-topic configurations. One could argue that we should do this globally for all configuration. I think that is not wise. The reason is because we currently assume configurations are immutable and pass them around in plain scala variables. This immutability is really nice. Many things cannot be changed dynamically (i.e. socket and other i/o buffer sizes) and for other things making them dynamic is just really hard.\nI would argue that having server-level defaults be statically configured is not a major problem, as these change rarely. Furthermore configuration management systems that maintain versions, track changes, handle permissions and notifications only work with text files so moving away from this is not necessarily a good thing.\nHowever maintaining topic-level settings in this way is a huge pain. These are set potentially every time you add a topic, and with hundreds of topics and users there are lots of changes. So having these all in a giant properties file on every server and bouncing each time is not a good solution. This proposal is just to move topic-level configuration out of the main server configuration.\nPer-Topic Settings\nThe current pattern is that we maintain default settings and sometimes have per-topic overrides. Here are the relevant settings:\nDefault Setting\nPer-Topic Setting\nNotes\nlog.segment.bytes\nlog.segment.bytes.per.topic\nlog.roll.hours\nlog.roll.hours.per.topic\nlog.retention.hours\nlog.retention.hours.per.topic\nlog.retention.bytes\nlog.retention.bytes.per.topic\nlog.cleanup.policy\ntopic.log.cleanup.policy.per.topic\nin KAFKA-631\nlog.cleaner.min.cleanable.ratio\nin KAFKA-631\nlog.index.interval.bytes\nlog.flush.interval.messages\nlog.flush.interval.ms\nlog.flush.interval.ms.per.topic\nlog.compression.type\nproposed\nProposal\nThe proposed approach is that we no longer have the \"per.topic\" version of configurations. Instead the server will be configured with a default value for each of these settings. When a topic is created the user can either specify the value for each setting, or, if they don't they will inherit the default. In this proposal each topic will have a complete copy of the configuration with any missing values taking whatever was the default at the time the topic was created.\nAlready in KAFKA-631 Log.scala has been changed so that it takes a single LogConfig argument that holds all configurations. As part of this proposal we will add a new setter for updating this config. Log has been changed so that it no longer maintains a local copy of any of these values, so swapping in a new config object\nThe configuration itself will be maintained in zookeeper. Currently I believe zookeeper has a structure like the following:\nget /brokers/topics/log-cleaner-test-1485952437-0  /brokers/\ntopics/\nmy-topic => {\"0\":[\"0\", \"1\"]}\nyour-topic => {...}\n{ \"0\": [\"0\"] }\nThis structure would be changed to something like the following:\n/brokers/\ntopics/\nmy-topic/\nreplicas => {0:[0,1], ...}\nconfig => {\"log.retention.bytes\": 12345,...}\n(not sure if this is the best layout...?)\nAll nodes would watch these config nodes and when one changed all brokers would update the appropriate in-memory log instances with the new config.\nCreating, altering, and deleting topics\nCurrently we have a CreateTopicCommand object that can be used to create topics. There is no corresponding delete. If this change were made to config we would also need the ability to change configs too.\nI propose adding a new APIs to the protocol:\nModifyTopicRequest => Operation TopicName [PropName PropValue]\nOperation => \"CREATE\" | \"DELETE\" | \"ALTER\"\nTopicName => String\nPropName => String\nPropValue => String\nModifyTopicResponse => ErrorCode\nNote that there is no attempt to encode the properties as fields in the protocol since it is assumed these may evolve quickly, instead they are just key-value pairs.\nThe existing tool would just call this API. The existing logic would move into KafkaApis.\nOpen Questions\nI am not so sure about the zookeeper layout, need help thinking that through...\nOne nuance of config is how defaults are handled. One approach would be to snapshot the full set of defaults into zookeeper at topic creation time for any setting not specified. The other approach would be to only save in zookeeper what the user gives and dynamically inherit the defaults. The difference is that in the later case it is easier to make a global config change and have it apply to all topics that haven't specified otherwise. This would also result in less data stored in zookeeper.\nShould we maybe just move all config into zookeeper?",
  "url": "https://cwiki.apache.org/confluence/display/KAFKA/Dynamic+Topic+Config",
  "space": "KAFKA",
  "labels": [],
  "last_modified": null,
  "source_type": "confluence"
}