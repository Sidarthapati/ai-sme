{
  "id": "confluence_display_KAFKA_Dynamically+Adjust+Log+Levels+in+Connect",
  "title": "Dynamically Adjust Log Levels in Connect - Apache Kafka - Apache Software Foundation",
  "content": "Status\nCurrent state\n:\nDraft (WIP).\nDiscussion thread\n:Â here\nVote thread\n:\nhere\nJIRA\n:\nKAFKA-7772\nReleased:\nAK x.y.z\nPull request\n:\nhttps://github.com/apache/kafka/pull/6069\nPlease keep the discussion on the mailing list rather than commenting on the wiki (wiki discussions get unwieldy fast).\nMotivation\nKafka Connect does not provide an out-of-the-box facility to change log levels. When debugging connectors or the Connect framework, one has to update the\nlog4j.properties\nfile and restart the worker to see new logs. This is cumbersome in most cases, and restarting the worker sometimes hides bugs by resetting the internal state.\nProposed Changes\nThe Kafka broker currently has a\nutility\nto adjust log levels via MBeans. This is a scala utility, that we will rewrite in Java, move to kafka-clients package and use this utility to initialize JMX interface in the Kafka broker and Connect worker upon startup.\nPublic Interfaces\nWe propose adding the following log4j controller:\npublic interface Log4jControllerMBean {\n/**\n* @return a list of all registered loggers\n*/\nList<String> getLoggers();\n/**\n* Get the effective log level for a given logger\n*\n* @param logger name of the logger\n* @return its log level (\"INFO\", for example)\n*/\nString getLogLevel(String logger);\n/**\n* Set the log level for a logger\n*\n* @param logger name of the logger\n* @param level desired level (\"INFO\", for example)\n* @return true, if successfully set, false otherwise.\n*/\nBoolean setLogLevel(String logger, String level);\n}\nApplications will register this mBean with the mBean server via a\nLogLevelManager\nutility class:\npublic class LogLevelManager {\n/**\n* Create and register a JMX mBean called Log4jController in the specified domain\n*\n* @param domain domain of the mBean\n*/\npublic static void registerLog4jController(String domain) {\n// implementation\n}\n}\nExample Usage\nAn application (such as the Connect worker) will use the\nLogLevelManager\nutility to initialize dynamic logging as follows:\nLogLevelManager.registerLog4jController(\"kafka.connect\");\nThis will provide a JMX bean\nLog4jController\nin the\nkafka.connect\ndomain, that will include a\nLoggers\nattribute, along with two operations:\ngetLogLevel\nand\nsetLogLevel\nthat we can use to get or set log levels for individual loggers in the process.\nBreaking Changes\nAlthough it was not formally introduced via a KIP, Kafka brokers already provide a similar feature. With this change, we bring about the following changes in it.\nThe name of the JMX bean changes from\nkafka.Log4jController\nto simply\nLog4jController\n. However, the bean will continue to be present in the\nkafka\ndomain.\nThe\ngetLogLevel\noperation now returns the\neffective log level\n. This means that previously, this operation could return null, if a log level was not explicitly set on the given logger. With the proposed changes, the log level of the parent logger will be queried until a non-null level is found (if none of the parents have their levels set, the root logger's level is returned).\nRejected Alternatives\nChanging log levels in a single node of an application will affect other nodes in the cluster (for example, changing log level of a class in one Connect worker will update levels in all workers in a Connect cluster) and this new level will be persisted across node restarts. This is beyond the scope of this proposal.\nRest extensions were rejected, as Kafka doesn't offer a REST server and we are aiming for a consistent experience across Kafka and Connect in this proposal.",
  "url": "https://cwiki.apache.org/confluence/display/KAFKA/Dynamically+Adjust+Log+Levels+in+Connect",
  "space": "KAFKA",
  "labels": [],
  "last_modified": null,
  "source_type": "confluence"
}