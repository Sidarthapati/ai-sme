{
  "id": "confluence_display_KAFKA_Kafka+Command+Line+and+Related+Improvements",
  "title": "Kafka Command Line and Related Improvements - Apache Kafka - Apache Software Foundation",
  "content": "The goals behind the command line shell are fundamentally to provide a centralized management for Kafka operations.\nThere are a lot of different kafka tools. Right now I think 5-6 of them are being used commonly.\nI was thinking we could start by taking\nhttps://cwiki.apache.org/confluence/display/KAFKA/System+Tools\nand\nhttps://cwiki.apache.org/confluence/display/KAFKA/Replication+tools\nand exposing them in a plugin type way for a command line shell interface.\nThis would also include a new global broker configuration management and access to the tools we already have outside of the scripts both through a new wire protocol message type.\n1) We need to add a new Admin message to the wire protocol that will be able to deal with passing the command line utility calls to the tools and global configuration manager on the broker (any broker). Any tool performing a task will (should be able to, need to flesh this out more) be able to execute but instead of on the command line will be on a broker thread. The controller will continue to-do the tasks it is doing today such as \"create topic\" however; the TopicCommand will be called from within the handleAdminRequestTools.\n2) We need to implement the handleAdminRequest.\n3) We need to build a client for the wire protocol. I think should be a simple CLI\nIt would be both: command line and shell.\nso\nkafka -b brokerlist -a reasign-partition status\nwould run from the cli and\nkafka shell -b brokerlist\nkafka>describe;\n... kafka-topics.sh --describe\nkafka>set topic_security\n['pci','profile','dss']\n= true\n...etc\nAn important item is that folks that are using existing tools we should have an easy api type way so they can keep doing that and get benefit too.\nThis interface should also have some monitoring stats too, e.g visualize in text the consumer lag trending between offset committed and log end offset.\nkafka>use topic name;\nkafka>stats;\nnot sure right this minute if we should do this in python, java or scala. I think whoever works on it can decide we can support accross the committers I think whatever it is. My thoughts are it should be in the ./clients folder.\n... we \"may\" also want to have the CLI expose and run via HTTP REST too however; I think this can be quickly easily done by someone simply if we build it right.\n4) The Global Configuration Manager. This is VERY important to the goals of these changes.  MANY configuration (much like topic level) are actually global to EVERY broker and brokers (through server.properties) should be able to override but the \"default\" should come from storage (for now zookeeper).\na) setting this goes through the CLI and the handleAdminRequest()\nb) using this is layered like this ... within KafkaApi we implement a new class that can flatten/figure out the right property.  Check server.properties (we can make that level 1) and if not found use what we get from storage (for now zookeeper) and if not found then use what is default in the code.  This will be very nice because you can set a default for EVERY broker for xyz configuration and not have to manage it accorss brokers with properties file. Centralized configuration\nThe top level for this work will be\nhttps://issues.apache.org/jira/browse/KAFKA-1694\nand broken into sub tickets.\nPotential Gotchas\nusing RQ/RP wire protocol to the controller\ninstead of the current way (via ZK admin path) may expose concurrency on\nthe admin requests, which may not be supported yet.\nhttps://issues.apache.org/jira/browse/KAFKA-1305\nProposed RQ/RP Format\nFor each type of Admin Request a separate type of Wire protocol message is created.\nCurrently there are 5 types of messages which support TopicCommand -\nCreateTopic(Request | Response)\n,\nAlterTopic\n,\nDeleteTopic\n,\nDescribeTopic\n,\nListTopics\n. And a special message type to identify cluster info -\nClusterMetadata\n(read Kafka Admin Command Line Internals for details).\nThe same notation as in\nA Guide To The Kafka Protocol\nis used here. The only difference - new Kafka Protocol metatype -\nMaybeOf\n(\n\"\n?\"\nin notation\n), when used means value is optional in message. To define value existence special control byte is prepended before each value (\n0\n- field is absent, otherwise - read value normally).\nCluster Metadata Request\nClusterMetadataRequest =>\nCluster Metadata Response\nClusterMEtadataResponse => ErrorCode [Broker] ?(Controller)\nErrorCode => int16\nBroker => NodeId Host Port\nNodeId => int32\nHost => string\nPort => int32\nController => Broker\nClusteMetadataRequest\nis a request with no arguments.\nClusterMetadataResponse\nholds error code (\n0\nin case of successful result), list of brokers in cluster and optionally broker serving a Controller's role (returning empty Controller most likely means either error during request processing or cluster being in some intermediate state).\nAdmin RQ/RP format\nAll admin messages listed below are required to be sent only to Controller broker. Only controller will process such messages. If Admin message is sent to an ordinary broker a special error code is returned (code\n22\n). In case of other failure during processing message\nAdminRequestFailedError\nis returned.\nError\nCode\nDescription\nAdminRequestFailed\n21\nUnexpected error occurred while processing Admin request.\nInvalidRequestTarget\n22\nTarget broker (id=<this_broker_id>) is not serving a controller's role.\nCreate Topic Request\nCreateTopicRequest => TopicName ?(Partitions) ?(Replicas) ?(ReplicaAssignment) [Config]\nTopicName => string\nPartitions => int32\nReplicas => int32\nReplicaAssignment => string\nConfig => string\nCreate Topic Response\nCreateTopicResponse => ErrorCode ?(ErrorDescription)\nErrorCode => int16\nErrorDescription => string\nCreateTopicRequest\nrequires topic name and either (partitions+replicas) or replicas assignment to create topic (validation is done on server side). You can also specify topic-level configs to create topic with (to use default set an empty array), format\nkey=value\n.\nCreateTopicResponse\nis fairly simple - you receive error code (\n0\nas always identifies\nNO_ERROR\n) and optionally error description. Usually it will hold the higher level exception that happened during command execution.\nAlter Topic Request\nAlterTopicRequest => TopicName ?(Partitions) ?(ReplicaAssignment) [AddedConfig]\n[DeletedConfig]\nTopicName => string\nPartitions => int32\nReplicas => int32\nAdded\nConfig => string\nDeleted\nConfig => string\nAlter Topic Response\nAlterTopicResponse => ErrorCode ?(ErrorDescription)\nErrorCode => int16\nErrorDescription => string\nAlterTopicRequest\nis similar to previous, to specify topic level settings that should be removed, use\nDeletedConfig\narray (just setting keys).\nAlterTopicResponse\nis similar to\nCreateTopicResponse\n.\nDelete Topic Request\nDeleteTopicRequest => TopicName\nTopicName => string\nDelete Topic Response\nDeleteTopicResponse => ErrorCode ?(ErrorDescription)\nErrorCode => int16\nErrorDescription => string\nDeleteTopicRequest\nrequires only topic name which should be deleted\n.\nDeleteTopicResponse\nis similar to\nCreateTopicResponse\n.\nDescribe Topic Request\nDescribeTopicRequest =>\nTopicName\nTopicName => string\nDescribe Topic Response\nDescribeTopicResponse => ErrorCode ?(ErrorDescription) ?(TopicDescription)\nErrorCode => int16\nErrorDescription => string\nTopicDescription\n=> TopicName TopicConfigDetails [TopicPartitionDetails]\nTopicName => string\nTopicConfigDetails => Partitions ReplicationFactor [Config]\nPartitions => int32\nReplicationFactor => int32\nConfig => overridden topic-level configs\nTopicPartitionsDetails => PartitionId ?(Leader) [Replica] [ISR]\nPartitionId => int32\nLeader => int32\nReplica => int32\nISR => int32\nDescribeTopicRequest\nrequires only topic name.\nDescribeTopicResponse\nbesides errorCode and optional errorDescription which are used in the same way as in previous messages, holds optional (non empty if execution was successful)\nTopicDescription\nstructure. Its structure is the following:\nField\nDescription\nTopicName\nThe name of the topic for which description is provided.\nTopicConfigDetails\nA structure that holds basic replication details.\nPartitions\nNumber of partitions in give topic.\nConfig\nTopic-level setting and value which was overridden.\nTopicPartitionDetails\nList describing replication details for each partition.\nPartitionId\nId of the partition.\nLeader\nOptional broekr-leader id for the described partition.\nReplicas\nList of broker ids serving a replica's role for the partition.\nISR\nSame as replicas but includes only brokers that are known to be \"in-sync\"\nList Topics Request\nListTopicsRequest =>\nList Topics Response\nListTopicsResponse => ErrorCode ?(ErrorDescription) ?(TopicsList)\nErrorCode => int16\nErrorDescription => string\nTopicsList => [TopicMarkedForDeletion] [AliveTopic]\nTopicMarkedForDeletion => string\nAliveTopic => string\nListTopicsRequest\nis a request with no arguments.\nListTopicsResponse\nbesides errorCode and optional errorDescription which are used in the same way as in previous messages, holds optional (non empty if execution was successful) two list of topic names - one for deleted topics (marked for deletion) and the second one for ordinary, alive topics.",
  "url": "https://cwiki.apache.org/confluence/display/KAFKA/Kafka+Command+Line+and+Related+Improvements",
  "space": "KAFKA",
  "labels": [],
  "last_modified": null,
  "source_type": "confluence"
}