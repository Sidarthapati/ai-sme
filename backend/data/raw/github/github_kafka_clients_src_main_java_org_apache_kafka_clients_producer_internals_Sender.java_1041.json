{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_producer_internals_Sender.java_1041",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/producer/internals/Sender.java",
  "content": "                MetricName totalMetricName = this.metrics.topicRecordSendTotal(metricTags);\n                topicRecordCount.add(new Meter(rateMetricName, totalMetricName));\n\n                String topicByteRateName = \"topic.\" + topic + \".bytes\";\n                Sensor topicByteRate = this.metrics.sensor(topicByteRateName);\n                rateMetricName = this.metrics.topicByteRate(metricTags);\n                totalMetricName = this.metrics.topicByteTotal(metricTags);\n                topicByteRate.add(new Meter(rateMetricName, totalMetricName));\n\n                String topicCompressionRateName = \"topic.\" + topic + \".compression-rate\";\n                Sensor topicCompressionRate = this.metrics.sensor(topicCompressionRateName);\n                MetricName m = this.metrics.topicCompressionRate(metricTags);\n                topicCompressionRate.add(m, new Avg());\n\n                String topicRetryName = \"topic.\" + topic + \".record-retries\";\n                Sensor topicRetrySensor = this.metrics.sensor(topicRetryName);\n                rateMetricName = this.metrics.topicRecordRetryRate(metricTags);\n                totalMetricName = this.metrics.topicRecordRetryTotal(metricTags);\n                topicRetrySensor.add(new Meter(rateMetricName, totalMetricName));\n\n                String topicErrorName = \"topic.\" + topic + \".record-errors\";\n                Sensor topicErrorSensor = this.metrics.sensor(topicErrorName);\n                rateMetricName = this.metrics.topicRecordErrorRate(metricTags);\n                totalMetricName = this.metrics.topicRecordErrorTotal(metricTags);\n                topicErrorSensor.add(new Meter(rateMetricName, totalMetricName));\n            }\n        }\n\n        public void updateProduceRequestMetrics(Map<Integer, List<ProducerBatch>> batches) {\n            long now = time.milliseconds();\n            for (List<ProducerBatch> nodeBatch : batches.values()) {\n                int records = 0;\n                for (ProducerBatch batch : nodeBatch) {\n                    // register all per-topic metrics at once\n                    String topic = batch.topicPartition.topic();\n                    maybeRegisterTopicMetrics(topic);\n\n                    // per-topic record send rate\n                    String topicRecordsCountName = \"topic.\" + topic + \".records-per-batch\";\n                    Sensor topicRecordCount = Objects.requireNonNull(this.metrics.getSensor(topicRecordsCountName));\n                    topicRecordCount.record(batch.recordCount);\n\n                    // per-topic bytes send rate\n                    String topicByteRateName = \"topic.\" + topic + \".bytes\";\n                    Sensor topicByteRate = Objects.requireNonNull(this.metrics.getSensor(topicByteRateName));\n                    topicByteRate.record(batch.estimatedSizeInBytes());\n\n                    // per-topic compression rate\n                    String topicCompressionRateName = \"topic.\" + topic + \".compression-rate\";\n                    Sensor topicCompressionRate = Objects.requireNonNull(this.metrics.getSensor(topicCompressionRateName));\n                    topicCompressionRate.record(batch.compressionRatio());\n\n                    // global metrics\n                    this.batchSizeSensor.record(batch.estimatedSizeInBytes(), now);\n                    this.queueTimeSensor.record(batch.queueTimeMs(), now);\n                    this.compressionRateSensor.record(batch.compressionRatio());\n                    this.maxRecordSizeSensor.record(batch.maxRecordSize, now);\n                    records += batch.recordCount;\n                }\n                this.recordsPerRequestSensor.record(records, now);\n            }\n        }\n\n        public void recordRetries(String topic, int count) {\n            long now = time.milliseconds();\n            this.retrySensor.record(count, now);\n            String topicRetryName = \"topic.\" + topic + \".record-retries\";\n            Sensor topicRetrySensor = this.metrics.getSensor(topicRetryName);\n            if (topicRetrySensor != null)\n                topicRetrySensor.record(count, now);\n        }\n\n        public void recordErrors(String topic, int count) {\n            long now = time.milliseconds();\n            this.errorSensor.record(count, now);\n            String topicErrorName = \"topic.\" + topic + \".record-errors\";\n            Sensor topicErrorSensor = this.metrics.getSensor(topicErrorName);\n            if (topicErrorSensor != null)\n                topicErrorSensor.record(count, now);\n        }\n\n        public void recordLatency(String node, long latency) {\n            long now = time.milliseconds();\n            this.requestTimeSensor.record(latency, now);\n            if (!node.isEmpty()) {\n                String nodeTimeName = \"node-\" + node + \".latency\";\n                Sensor nodeRequestTime = this.metrics.getSensor(nodeTimeName);\n                if (nodeRequestTime != null)\n                    nodeRequestTime.record(latency, now);\n            }\n        }\n\n        void recordBatchSplit() {\n            this.batchSplitSensor.record();\n        }\n    }\n\n    public static class SenderThread extends KafkaThread {\n\n        public SenderThread(final String name, Runnable runnable, boolean daemon) {\n            super(name, runnable, daemon);\n        }\n    }\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/internals/Sender.java#L1041-L1145",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/producer/internals/Sender.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 1041,
  "end_line": 1145,
  "last_modified": "2026-02-06T01:16:27.610196",
  "source_type": "github"
}