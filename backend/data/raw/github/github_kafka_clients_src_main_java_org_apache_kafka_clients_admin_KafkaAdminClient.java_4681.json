{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_admin_KafkaAdminClient.java_4681",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java",
  "content": "                    replica.logEndOffset(),\n                    replica.lastFetchTimestamp() == -1 ? OptionalLong.empty() : OptionalLong.of(replica.lastFetchTimestamp()),\n                    replica.lastCaughtUpTimestamp() == -1 ? OptionalLong.empty() : OptionalLong.of(replica.lastCaughtUpTimestamp()));\n            }\n\n            private QuorumInfo createQuorumResult(final DescribeQuorumResponseData.PartitionData partition, DescribeQuorumResponseData.NodeCollection nodeCollection) {\n                List<QuorumInfo.ReplicaState> voters = partition.currentVoters().stream()\n                    .map(this::translateReplicaState)\n                    .collect(Collectors.toList());\n\n                List<QuorumInfo.ReplicaState> observers = partition.observers().stream()\n                    .map(this::translateReplicaState)\n                    .collect(Collectors.toList());\n\n                Map<Integer, QuorumInfo.Node> nodes = nodeCollection.stream().map(n -> {\n                    List<RaftVoterEndpoint> endpoints = n.listeners().stream()\n                        .map(l -> new RaftVoterEndpoint(l.name(), l.host(), l.port()))\n                        .collect(Collectors.toList());\n\n                    return new QuorumInfo.Node(n.nodeId(), endpoints);\n                }).collect(Collectors.toMap(QuorumInfo.Node::nodeId, Function.identity()));\n\n                return new QuorumInfo(\n                    partition.leaderId(),\n                    partition.leaderEpoch(),\n                    partition.highWatermark(),\n                    voters,\n                    observers,\n                    nodes\n                );\n            }\n\n            @Override\n            DescribeQuorumRequest.Builder createRequest(int timeoutMs) {\n                return new Builder(DescribeQuorumRequest.singletonRequest(\n                    new TopicPartition(CLUSTER_METADATA_TOPIC_NAME, CLUSTER_METADATA_TOPIC_PARTITION.partition())));\n            }\n\n            @Override\n            void handleResponse(AbstractResponse response) {\n                handleNotControllerError(response);\n                final DescribeQuorumResponse quorumResponse = (DescribeQuorumResponse) response;\n                if (quorumResponse.data().errorCode() != Errors.NONE.code()) {\n                    throw Errors.forCode(quorumResponse.data().errorCode()).exception(quorumResponse.data().errorMessage());\n                }\n                if (quorumResponse.data().topics().size() != 1) {\n                    String msg = String.format(\"DescribeMetadataQuorum received %d topics when 1 was expected\",\n                        quorumResponse.data().topics().size());\n                    log.debug(msg);\n                    throw new UnknownServerException(msg);\n                }\n                DescribeQuorumResponseData.TopicData topic = quorumResponse.data().topics().get(0);\n                if (!topic.topicName().equals(CLUSTER_METADATA_TOPIC_NAME)) {\n                    String msg = String.format(\"DescribeMetadataQuorum received a topic with name %s when %s was expected\",\n                        topic.topicName(), CLUSTER_METADATA_TOPIC_NAME);\n                    log.debug(msg);\n                    throw new UnknownServerException(msg);\n                }\n                if (topic.partitions().size() != 1) {\n                    String msg = String.format(\"DescribeMetadataQuorum received a topic %s with %d partitions when 1 was expected\",\n                        topic.topicName(), topic.partitions().size());\n                    log.debug(msg);\n                    throw new UnknownServerException(msg);\n                }\n                DescribeQuorumResponseData.PartitionData partition = topic.partitions().get(0);\n                if (partition.partitionIndex() != CLUSTER_METADATA_TOPIC_PARTITION.partition()) {\n                    String msg = String.format(\"DescribeMetadataQuorum received a single partition with index %d when %d was expected\",\n                        partition.partitionIndex(), CLUSTER_METADATA_TOPIC_PARTITION.partition());\n                    log.debug(msg);\n                    throw new UnknownServerException(msg);\n                }\n                if (partition.errorCode() != Errors.NONE.code()) {\n                    throw Errors.forCode(partition.errorCode()).exception(partition.errorMessage());\n                }\n                future.complete(createQuorumResult(partition, quorumResponse.data().nodes()));\n            }\n\n            @Override\n            void handleFailure(Throwable throwable) {\n                future.completeExceptionally(throwable);\n            }\n        };\n\n        runnable.call(call, now);\n        return new DescribeMetadataQuorumResult(future);\n    }\n\n    @Override\n    public UnregisterBrokerResult unregisterBroker(int brokerId, UnregisterBrokerOptions options) {\n        final KafkaFutureImpl<Void> future = new KafkaFutureImpl<>();\n        final long now = time.milliseconds();\n        final Call call = new Call(\"unregisterBroker\", calcDeadlineMs(now, options.timeoutMs()),\n            new LeastLoadedBrokerOrActiveKController()) {\n\n            @Override\n            UnregisterBrokerRequest.Builder createRequest(int timeoutMs) {\n                UnregisterBrokerRequestData data =\n                    new UnregisterBrokerRequestData().setBrokerId(brokerId);\n                return new UnregisterBrokerRequest.Builder(data);\n            }\n\n            @Override\n            void handleResponse(AbstractResponse abstractResponse) {\n                final UnregisterBrokerResponse response =\n                    (UnregisterBrokerResponse) abstractResponse;\n                Errors error = Errors.forCode(response.data().errorCode());\n                switch (error) {\n                    case NONE:\n                        future.complete(null);\n                        break;\n                    case REQUEST_TIMED_OUT:\n                        throw error.exception(response.data().errorMessage());\n                    default:\n                        log.error(\"Unregister broker request for broker ID {} failed: {}\",\n                            brokerId, response.data().errorMessage());\n                        future.completeExceptionally(error.exception(response.data().errorMessage()));\n                        break;\n                }\n            }\n\n            @Override\n            void handleFailure(Throwable throwable) {\n                future.completeExceptionally(throwable);\n            }\n        };\n        runnable.call(call, now);\n        return new UnregisterBrokerResult(future);\n    }\n\n    @Override\n    public DescribeProducersResult describeProducers(Collection<TopicPartition> topicPartitions, DescribeProducersOptions options) {\n        PartitionLeaderStrategy.PartitionLeaderFuture<DescribeProducersResult.PartitionProducerState> future =\n            DescribeProducersHandler.newFuture(topicPartitions, partitionLeaderCache);\n        DescribeProducersHandler handler = new DescribeProducersHandler(options, logContext);\n        invokeDriver(handler, future, options.timeoutMs);\n        return new DescribeProducersResult(future.all());\n    }\n\n    @Override\n    public DescribeTransactionsResult describeTransactions(Collection<String> transactionalIds, DescribeTransactionsOptions options) {\n        AdminApiFuture.SimpleAdminApiFuture<CoordinatorKey, TransactionDescription> future =\n            DescribeTransactionsHandler.newFuture(transactionalIds);\n        DescribeTransactionsHandler handler = new DescribeTransactionsHandler(logContext);\n        invokeDriver(handler, future, options.timeoutMs);\n        return new DescribeTransactionsResult(future.all());\n    }\n\n    @Override\n    public AbortTransactionResult abortTransaction(AbortTransactionSpec spec, AbortTransactionOptions options) {\n        PartitionLeaderStrategy.PartitionLeaderFuture<Void> future =",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java#L4681-L4830",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 4681,
  "end_line": 4830,
  "last_modified": "2026-02-06T01:16:27.585045",
  "source_type": "github"
}