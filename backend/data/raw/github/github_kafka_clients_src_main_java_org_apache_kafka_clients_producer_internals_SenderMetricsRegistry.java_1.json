{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_producer_internals_SenderMetricsRegistry.java_1",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/producer/internals/SenderMetricsRegistry.java",
  "content": "/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License. You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.apache.kafka.clients.producer.internals;\n\nimport org.apache.kafka.common.MetricName;\nimport org.apache.kafka.common.MetricNameTemplate;\nimport org.apache.kafka.common.metrics.Measurable;\nimport org.apache.kafka.common.metrics.Metrics;\nimport org.apache.kafka.common.metrics.Sensor;\n\nimport java.util.ArrayList;\nimport java.util.LinkedHashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\n\npublic class SenderMetricsRegistry {\n\n    static final String TOPIC_METRIC_GROUP_NAME = \"producer-topic-metrics\";\n\n    private final List<MetricNameTemplate> allTemplates;\n\n    public final MetricName batchSizeAvg;\n    public final MetricName batchSizeMax;\n    public final MetricName compressionRateAvg;\n    public final MetricName recordQueueTimeAvg;\n    public final MetricName recordQueueTimeMax;\n    public final MetricName requestLatencyAvg;\n    public final MetricName requestLatencyMax;   \n    public final MetricName produceThrottleTimeAvg;\n    public final MetricName produceThrottleTimeMax;\n    public final MetricName recordSendRate;\n    public final MetricName recordSendTotal;\n    public final MetricName recordsPerRequestAvg;\n    public final MetricName recordRetryRate;\n    public final MetricName recordRetryTotal;\n    public final MetricName recordErrorRate;\n    public final MetricName recordErrorTotal;\n    public final MetricName recordSizeMax;\n    public final MetricName recordSizeAvg;\n    public final MetricName requestsInFlight;\n    public final MetricName metadataAge;\n    public final MetricName batchSplitRate;\n    public final MetricName batchSplitTotal;\n\n    private final MetricNameTemplate topicRecordSendRate;\n    private final MetricNameTemplate topicRecordSendTotal;\n    private final MetricNameTemplate topicByteRate;\n    private final MetricNameTemplate topicByteTotal;\n    private final MetricNameTemplate topicCompressionRate;\n    private final MetricNameTemplate topicRecordRetryRate;\n    private final MetricNameTemplate topicRecordRetryTotal;\n    private final MetricNameTemplate topicRecordErrorRate;\n    private final MetricNameTemplate topicRecordErrorTotal;\n    \n    private final Metrics metrics;\n    private final Set<String> tags;\n    private final LinkedHashSet<String> topicTags;\n\n    public SenderMetricsRegistry(Metrics metrics) {\n        this.metrics = metrics;\n        this.tags = this.metrics.config().tags().keySet();\n        this.allTemplates = new ArrayList<>();\n        \n        /* Client level */\n        \n        this.batchSizeAvg = createMetricName(\"batch-size-avg\",\n                \"The average number of bytes sent per partition per-request.\");\n        this.batchSizeMax = createMetricName(\"batch-size-max\",\n                \"The max number of bytes sent per partition per-request.\");\n        this.compressionRateAvg = createMetricName(\"compression-rate-avg\",\n                \"The average compression rate of record batches, defined as the average ratio of the \" +\n                        \"compressed batch size over the uncompressed size.\");\n        this.recordQueueTimeAvg = createMetricName(\"record-queue-time-avg\",\n                \"The average time in ms record batches spent in the send buffer.\");\n        this.recordQueueTimeMax = createMetricName(\"record-queue-time-max\",\n                \"The maximum time in ms record batches spent in the send buffer.\");\n        this.requestLatencyAvg = createMetricName(\"request-latency-avg\", \n                \"The average request latency in ms\");\n        this.requestLatencyMax = createMetricName(\"request-latency-max\", \n                \"The maximum request latency in ms\");\n        this.recordSendRate = createMetricName(\"record-send-rate\", \n                \"The average number of records sent per second.\");\n        this.recordSendTotal = createMetricName(\"record-send-total\", \n                \"The total number of records sent.\");\n        this.recordsPerRequestAvg = createMetricName(\"records-per-request-avg\",\n                \"The average number of records per request.\");\n        this.recordRetryRate = createMetricName(\"record-retry-rate\",\n                \"The average per-second number of retried record sends\");\n        this.recordRetryTotal = createMetricName(\"record-retry-total\", \n                \"The total number of retried record sends\");\n        this.recordErrorRate = createMetricName(\"record-error-rate\",\n                \"The average per-second number of record sends that resulted in errors\");\n        this.recordErrorTotal = createMetricName(\"record-error-total\",\n                \"The total number of record sends that resulted in errors\");\n        this.recordSizeMax = createMetricName(\"record-size-max\", \n                \"The maximum record size\");\n        this.recordSizeAvg = createMetricName(\"record-size-avg\", \n                \"The average record size\");\n        this.requestsInFlight = createMetricName(\"requests-in-flight\",\n                \"The current number of in-flight requests awaiting a response.\");\n        this.metadataAge = createMetricName(\"metadata-age\",\n                \"The age in seconds of the current producer metadata being used.\");\n        this.batchSplitRate = createMetricName(\"batch-split-rate\", \n                \"The average number of batch splits per second\");\n        this.batchSplitTotal = createMetricName(\"batch-split-total\", \n                \"The total number of batch splits\");\n\n        this.produceThrottleTimeAvg = createMetricName(\"produce-throttle-time-avg\",\n                \"The average time in ms a request was throttled by a broker\");\n        this.produceThrottleTimeMax = createMetricName(\"produce-throttle-time-max\",\n                \"The maximum time in ms a request was throttled by a broker\");\n\n        /* Topic level */\n        this.topicTags = new LinkedHashSet<>(tags);\n        this.topicTags.add(\"topic\");\n\n        // We can't create the MetricName up front for these, because we don't know the topic name yet.\n        this.topicRecordSendRate = createTopicTemplate(\"record-send-rate\",\n                \"The average number of records sent per second for a topic.\");\n        this.topicRecordSendTotal = createTopicTemplate(\"record-send-total\",\n                \"The total number of records sent for a topic.\");\n        this.topicByteRate = createTopicTemplate(\"byte-rate\",\n                \"The average number of bytes sent per second for a topic.\");\n        this.topicByteTotal = createTopicTemplate(\"byte-total\", \n                \"The total number of bytes sent for a topic.\");\n        this.topicCompressionRate = createTopicTemplate(\"compression-rate\",\n                \"The average compression rate of record batches for a topic, defined as the average ratio \" +\n                        \"of the compressed batch size over the uncompressed size.\");\n        this.topicRecordRetryRate = createTopicTemplate(\"record-retry-rate\",\n                \"The average per-second number of retried record sends for a topic\");\n        this.topicRecordRetryTotal = createTopicTemplate(\"record-retry-total\",\n                \"The total number of retried record sends for a topic\");\n        this.topicRecordErrorRate = createTopicTemplate(\"record-error-rate\",\n                \"The average per-second number of record sends that resulted in errors for a topic\");\n        this.topicRecordErrorTotal = createTopicTemplate(\"record-error-total\",",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/internals/SenderMetricsRegistry.java#L1-L150",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/producer/internals/SenderMetricsRegistry.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 1,
  "end_line": 150,
  "last_modified": "2026-02-06T01:16:27.610300",
  "source_type": "github"
}