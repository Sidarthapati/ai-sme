{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_producer_ProducerInterceptor.java_1",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/producer/ProducerInterceptor.java",
  "content": "/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License. You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.apache.kafka.clients.producer;\n\nimport org.apache.kafka.common.Configurable;\nimport org.apache.kafka.common.header.Headers;\n\n/**\n * A plugin interface that allows you to intercept (and possibly mutate) the records received by the producer before\n * they are published to the Kafka cluster.\n * <p>\n * This class will get producer config properties via <code>configure()</code> method, including clientId assigned\n * by KafkaProducer if not specified in the producer config. The interceptor implementation needs to be aware that it will be\n * sharing producer config namespace with other interceptors and serializers, and ensure that there are no conflicts.\n * <p>\n * Exceptions thrown by ProducerInterceptor methods will be caught, logged, but not propagated further. As a result, if\n * the user configures the interceptor with the wrong key and value type parameters, the producer will not throw an exception,\n * just log the errors.\n * <p>\n * ProducerInterceptor callbacks may be called from multiple threads. Interceptor implementation must ensure thread-safety, if needed.\n * <p>\n * Implement {@link org.apache.kafka.common.ClusterResourceListener} to receive cluster metadata once it's available. Please see the class documentation for ClusterResourceListener for more information.\n * Implement {@link org.apache.kafka.common.metrics.Monitorable} to enable the interceptor to register metrics. The following tags are automatically added to\n * all metrics registered: <code>config</code> set to <code>interceptor.classes</code>, and <code>class</code> set to the ProducerInterceptor class name.\n */\npublic interface ProducerInterceptor<K, V> extends Configurable, AutoCloseable {\n    /**\n     * This is called from {@link org.apache.kafka.clients.producer.KafkaProducer#send(ProducerRecord)} and\n     * {@link org.apache.kafka.clients.producer.KafkaProducer#send(ProducerRecord, Callback)} methods, before key and value\n     * get serialized and partition is assigned (if partition is not specified in ProducerRecord).\n     * <p>\n     * This method is allowed to modify the record, in which case, the new record will be returned. The implication of modifying\n     * key/value is that partition assignment (if not specified in ProducerRecord) will be done based on modified key/value,\n     * not key/value from the client. Consequently, key and value transformation done in onSend() needs to be consistent:\n     * same key and value should mutate to the same (modified) key and value. Otherwise, log compaction would not work\n     * as expected.\n     * <p>\n     * Similarly, it is up to interceptor implementation to ensure that correct topic/partition is returned in ProducerRecord.\n     * Most often, it should be the same topic/partition from 'record'.\n     * <p>\n     * Any exception thrown by this method will be caught by the caller and logged, but not propagated further.\n     * <p>\n     * Since the producer may run multiple interceptors, a particular interceptor's onSend() callback will be called in the order\n     * specified by {@link org.apache.kafka.clients.producer.ProducerConfig#INTERCEPTOR_CLASSES_CONFIG}. The first interceptor\n     * in the list gets the record passed from the client, the following interceptor will be passed the record returned by the\n     * previous interceptor, and so on. Since interceptors are allowed to modify records, interceptors may potentially get\n     * the record already modified by other interceptors. However, building a pipeline of mutable interceptors that depend on the output\n     * of the previous interceptor is discouraged, because of potential side-effects caused by interceptors potentially failing to\n     * modify the record and throwing an exception. If one of the interceptors in the list throws an exception from onSend(), the exception\n     * is caught, logged, and the next interceptor is called with the record returned by the last successful interceptor in the list,\n     * or otherwise the client.\n     *\n     * @param record the record from client or the record returned by the previous interceptor in the chain of interceptors.\n     * @return producer record to send to topic/partition\n     */\n    ProducerRecord<K, V> onSend(ProducerRecord<K, V> record);\n\n    /**\n     * This method is called when the record sent to the server has been acknowledged, or when sending the record fails before\n     * it gets sent to the server.\n     * <p>\n     * This method is generally called just before the user callback is called, and in additional cases when <code>KafkaProducer.send()</code>\n     * throws an exception.\n     * <p>\n     * Any exception thrown by this method will be ignored by the caller.\n     * <p>\n     * This method will generally execute in the background I/O thread, so the implementation should be reasonably fast.\n     * Otherwise, sending of messages from other threads could be delayed.\n     *\n     * @param metadata The metadata for the record that was sent (i.e. the partition and offset).\n     *                 If an error occurred, metadata will contain only valid topic and maybe\n     *                 partition. If partition is not given in ProducerRecord and an error occurs\n     *                 before partition gets assigned, then partition will be set to {@link RecordMetadata#UNKNOWN_PARTITION}.\n     *                 The metadata may be null if the client passed null record to\n     *                 {@link org.apache.kafka.clients.producer.KafkaProducer#send(ProducerRecord)}.\n     * @param exception The exception thrown during processing of this record. Null if no error occurred.\n     */\n    default void onAcknowledgement(RecordMetadata metadata, Exception exception) {}\n\n    /**\n     * This method is called when the record sent to the server has been acknowledged, or when sending the record fails before\n     * it gets sent to the server.\n     * <p>\n     * This method is generally called just before the user callback is called, and in additional cases when <code>KafkaProducer.send()</code>\n     * throws an exception.\n     * <p>\n     * Any exception thrown by this method will be ignored by the caller.\n     * <p>\n     * This method will generally execute in the background I/O thread, so the implementation should be reasonably fast.\n     * Otherwise, sending of messages from other threads could be delayed.\n     *\n     * @param metadata The metadata for the record that was sent (i.e. the partition and offset).\n     *                 If an error occurred, metadata will contain only valid topic and maybe\n     *                 partition. If partition is not given in ProducerRecord and an error occurs\n     *                 before partition gets assigned, then partition will be set to {@link RecordMetadata#UNKNOWN_PARTITION}.\n     *                 The metadata may be null if the client passed null record to\n     *                 {@link org.apache.kafka.clients.producer.KafkaProducer#send(ProducerRecord)}.\n     * @param exception The exception thrown during processing of this record. Null if no error occurred.\n     * @param headers The headers for the record that was sent. It is read-only.\n     */\n    default void onAcknowledgement(RecordMetadata metadata, Exception exception, Headers headers) {\n        onAcknowledgement(metadata, exception);\n    }\n\n    /**\n     * This is called when interceptor is closed\n     */\n    void close();\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/ProducerInterceptor.java#L1-L124",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/producer/ProducerInterceptor.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 1,
  "end_line": 124,
  "last_modified": "2026-02-06T01:16:27.608763",
  "source_type": "github"
}