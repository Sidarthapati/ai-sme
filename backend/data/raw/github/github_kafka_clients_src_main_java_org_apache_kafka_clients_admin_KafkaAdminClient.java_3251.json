{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_admin_KafkaAdminClient.java_3251",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java",
  "content": "                // the initial error back to the caller if the request timed out.\n                maybeCompleteQuotaExceededException(options.shouldRetryOnQuotaViolation(),\n                    throwable, futures, quotaExceededExceptions, (int) (time.milliseconds() - now));\n                // Fail all the other remaining futures\n\n                completeAllExceptionally(futures.values(), throwable);\n            }\n        };\n    }\n\n    @Override\n    public DeleteRecordsResult deleteRecords(final Map<TopicPartition, RecordsToDelete> recordsToDelete,\n                                             final DeleteRecordsOptions options) {\n        PartitionLeaderStrategy.PartitionLeaderFuture<DeletedRecords> future =\n            DeleteRecordsHandler.newFuture(recordsToDelete.keySet(), partitionLeaderCache);\n        int timeoutMs = defaultApiTimeoutMs;\n        if (options.timeoutMs() != null) {\n            timeoutMs = options.timeoutMs();\n        }\n        DeleteRecordsHandler handler = new DeleteRecordsHandler(recordsToDelete, logContext, timeoutMs);\n        invokeDriver(handler, future, options.timeoutMs);\n\n        return new DeleteRecordsResult(future.all());\n    }\n\n    @Override\n    public CreateDelegationTokenResult createDelegationToken(final CreateDelegationTokenOptions options) {\n        final KafkaFutureImpl<DelegationToken> delegationTokenFuture = new KafkaFutureImpl<>();\n        final long now = time.milliseconds();\n        List<CreatableRenewers> renewers = new ArrayList<>();\n        for (KafkaPrincipal principal : options.renewers()) {\n            renewers.add(new CreatableRenewers()\n                .setPrincipalName(principal.getName())\n                .setPrincipalType(principal.getPrincipalType()));\n        }\n        runnable.call(new Call(\"createDelegationToken\", calcDeadlineMs(now, options.timeoutMs()),\n            new LeastLoadedNodeProvider()) {\n\n            @Override\n            CreateDelegationTokenRequest.Builder createRequest(int timeoutMs) {\n                CreateDelegationTokenRequestData data = new CreateDelegationTokenRequestData()\n                    .setRenewers(renewers)\n                    .setMaxLifetimeMs(options.maxLifetimeMs());\n                if (options.owner().isPresent()) {\n                    data.setOwnerPrincipalName(options.owner().get().getName());\n                    data.setOwnerPrincipalType(options.owner().get().getPrincipalType());\n                }\n                return new CreateDelegationTokenRequest.Builder(data);\n            }\n\n            @Override\n            void handleResponse(AbstractResponse abstractResponse) {\n                CreateDelegationTokenResponse response = (CreateDelegationTokenResponse) abstractResponse;\n                if (response.hasError()) {\n                    delegationTokenFuture.completeExceptionally(response.error().exception());\n                } else {\n                    CreateDelegationTokenResponseData data = response.data();\n                    TokenInformation tokenInfo = new TokenInformation(data.tokenId(), new KafkaPrincipal(data.principalType(), data.principalName()),\n                        new KafkaPrincipal(data.tokenRequesterPrincipalType(), data.tokenRequesterPrincipalName()),\n                        options.renewers(), data.issueTimestampMs(), data.maxTimestampMs(), data.expiryTimestampMs());\n                    DelegationToken token = new DelegationToken(tokenInfo, data.hmac());\n                    delegationTokenFuture.complete(token);\n                }\n            }\n\n            @Override\n            void handleFailure(Throwable throwable) {\n                delegationTokenFuture.completeExceptionally(throwable);\n            }\n        }, now);\n\n        return new CreateDelegationTokenResult(delegationTokenFuture);\n    }\n\n    @Override\n    public RenewDelegationTokenResult renewDelegationToken(final byte[] hmac, final RenewDelegationTokenOptions options) {\n        final KafkaFutureImpl<Long> expiryTimeFuture = new KafkaFutureImpl<>();\n        final long now = time.milliseconds();\n        runnable.call(new Call(\"renewDelegationToken\", calcDeadlineMs(now, options.timeoutMs()),\n            new LeastLoadedNodeProvider()) {\n\n            @Override\n            RenewDelegationTokenRequest.Builder createRequest(int timeoutMs) {\n                return new RenewDelegationTokenRequest.Builder(\n                    new RenewDelegationTokenRequestData()\n                        .setHmac(hmac)\n                        .setRenewPeriodMs(options.renewTimePeriodMs()));\n            }\n\n            @Override\n            void handleResponse(AbstractResponse abstractResponse) {\n                RenewDelegationTokenResponse response = (RenewDelegationTokenResponse) abstractResponse;\n                if (response.hasError()) {\n                    expiryTimeFuture.completeExceptionally(response.error().exception());\n                } else {\n                    expiryTimeFuture.complete(response.expiryTimestamp());\n                }\n            }\n\n            @Override\n            void handleFailure(Throwable throwable) {\n                expiryTimeFuture.completeExceptionally(throwable);\n            }\n        }, now);\n\n        return new RenewDelegationTokenResult(expiryTimeFuture);\n    }\n\n    @Override\n    public ExpireDelegationTokenResult expireDelegationToken(final byte[] hmac, final ExpireDelegationTokenOptions options) {\n        final KafkaFutureImpl<Long> expiryTimeFuture = new KafkaFutureImpl<>();\n        final long now = time.milliseconds();\n        runnable.call(new Call(\"expireDelegationToken\", calcDeadlineMs(now, options.timeoutMs()),\n            new LeastLoadedNodeProvider()) {\n\n            @Override\n            ExpireDelegationTokenRequest.Builder createRequest(int timeoutMs) {\n                return new ExpireDelegationTokenRequest.Builder(\n                    new ExpireDelegationTokenRequestData()\n                        .setHmac(hmac)\n                        .setExpiryTimePeriodMs(options.expiryTimePeriodMs()));\n            }\n\n            @Override\n            void handleResponse(AbstractResponse abstractResponse) {\n                ExpireDelegationTokenResponse response = (ExpireDelegationTokenResponse) abstractResponse;\n                if (response.hasError()) {\n                    expiryTimeFuture.completeExceptionally(response.error().exception());\n                } else {\n                    expiryTimeFuture.complete(response.expiryTimestamp());\n                }\n            }\n\n            @Override\n            void handleFailure(Throwable throwable) {\n                expiryTimeFuture.completeExceptionally(throwable);\n            }\n        }, now);\n\n        return new ExpireDelegationTokenResult(expiryTimeFuture);\n    }\n\n    @Override\n    public DescribeDelegationTokenResult describeDelegationToken(final DescribeDelegationTokenOptions options) {\n        final KafkaFutureImpl<List<DelegationToken>> tokensFuture = new KafkaFutureImpl<>();\n        final long now = time.milliseconds();\n        runnable.call(new Call(\"describeDelegationToken\", calcDeadlineMs(now, options.timeoutMs()),\n            new LeastLoadedNodeProvider()) {\n\n            @Override",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java#L3251-L3400",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 3251,
  "end_line": 3400,
  "last_modified": "2026-02-06T01:16:27.585045",
  "source_type": "github"
}