{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_admin_KafkaAdminClient.java_391",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java",
  "content": "     */\n    private final Thread thread;\n\n    /**\n     * During a close operation, this is the time at which we will time out all pending operations\n     * and force the RPC thread to exit. If the admin client is not closing, this will be 0.\n     */\n    private final AtomicLong hardShutdownTimeMs = new AtomicLong(INVALID_SHUTDOWN_TIME);\n\n    /**\n     * A factory which creates TimeoutProcessors for the RPC thread.\n     */\n    private final TimeoutProcessorFactory timeoutProcessorFactory;\n\n    private final int maxRetries;\n\n    private final long retryBackoffMs;\n    private final long retryBackoffMaxMs;\n    private final ExponentialBackoff retryBackoff;\n    private final MetadataRecoveryStrategy metadataRecoveryStrategy;\n    private final PartitionLeaderCache partitionLeaderCache;\n    private final AdminFetchMetricsManager adminFetchMetricsManager;\n    private final Optional<ClientTelemetryReporter> clientTelemetryReporter;\n\n    /**\n     * The telemetry requests client instance id.\n     */\n    private Uuid clientInstanceId;\n\n    /**\n     * Get or create a list value from a map.\n     *\n     * @param map The map to get or create the element from.\n     * @param key The key.\n     * @param <K> The key type.\n     * @param <V> The value type.\n     * @return The list value.\n     */\n    static <K, V> List<V> getOrCreateListValue(Map<K, List<V>> map, K key) {\n        return map.computeIfAbsent(key, k -> new LinkedList<>());\n    }\n\n    /**\n     * Send an exception to every element in a collection of KafkaFutureImpls.\n     *\n     * @param futures The collection of KafkaFutureImpl objects.\n     * @param exc     The exception\n     * @param <T>     The KafkaFutureImpl result type.\n     */\n    private static <T> void completeAllExceptionally(Collection<KafkaFutureImpl<T>> futures, Throwable exc) {\n        completeAllExceptionally(futures.stream(), exc);\n    }\n\n    /**\n     * Send an exception to all futures in the provided stream\n     *\n     * @param futures The stream of KafkaFutureImpl objects.\n     * @param exc     The exception\n     * @param <T>     The KafkaFutureImpl result type.\n     */\n    private static <T> void completeAllExceptionally(Stream<KafkaFutureImpl<T>> futures, Throwable exc) {\n        futures.forEach(future -> future.completeExceptionally(exc));\n    }\n\n    /**\n     * Get the current time remaining before a deadline as an integer.\n     *\n     * @param now        The current time in milliseconds.\n     * @param deadlineMs The deadline time in milliseconds.\n     * @return The time delta in milliseconds.\n     */\n    static int calcTimeoutMsRemainingAsInt(long now, long deadlineMs) {\n        long deltaMs = deadlineMs - now;\n        if (deltaMs > Integer.MAX_VALUE)\n            deltaMs = Integer.MAX_VALUE;\n        else if (deltaMs < Integer.MIN_VALUE)\n            deltaMs = Integer.MIN_VALUE;\n        return (int) deltaMs;\n    }\n\n    /**\n     * Generate the client id based on the configuration.\n     *\n     * @param config The configuration\n     * @return The client id\n     */\n    static String generateClientId(AdminClientConfig config) {\n        String clientId = config.getString(AdminClientConfig.CLIENT_ID_CONFIG);\n        if (!clientId.isEmpty())\n            return clientId;\n        return \"adminclient-\" + ADMIN_CLIENT_ID_SEQUENCE.getAndIncrement();\n    }\n\n    String getClientId() {\n        return clientId;\n    }\n\n    /**\n     * Get the deadline for a particular call.\n     *\n     * @param now             The current time in milliseconds.\n     * @param optionTimeoutMs The timeout option given by the user.\n     * @return The deadline in milliseconds.\n     */\n    private long calcDeadlineMs(long now, Integer optionTimeoutMs) {\n        if (optionTimeoutMs != null)\n            return now + Math.max(0, optionTimeoutMs);\n        return now + defaultApiTimeoutMs;\n    }\n\n    /**\n     * Pretty-print an exception.\n     *\n     * @param throwable The exception.\n     * @return A compact human-readable string.\n     */\n    static String prettyPrintException(Throwable throwable) {\n        if (throwable == null)\n            return \"Null exception.\";\n        if (throwable.getMessage() != null) {\n            return throwable.getClass().getSimpleName() + \": \" + throwable.getMessage();\n        }\n        return throwable.getClass().getSimpleName();\n    }\n\n    static KafkaAdminClient createInternal(AdminClientConfig config, TimeoutProcessorFactory timeoutProcessorFactory) {\n        return createInternal(config, timeoutProcessorFactory, null);\n    }\n\n    static KafkaAdminClient createInternal(\n        AdminClientConfig config,\n        TimeoutProcessorFactory timeoutProcessorFactory,\n        HostResolver hostResolver\n    ) {\n        Metrics metrics = null;\n        NetworkClient networkClient = null;\n        Time time = Time.SYSTEM;\n        String clientId = generateClientId(config);\n        ApiVersions apiVersions = new ApiVersions();\n        LogContext logContext = createLogContext(clientId);\n        Optional<ClientTelemetryReporter> clientTelemetryReporter;\n\n        try {\n            // Since we only request node information, it's safe to pass true for allowAutoTopicCreation (and it\n            // simplifies communication with older brokers)\n            AdminBootstrapAddresses adminAddresses = AdminBootstrapAddresses.fromConfig(config);\n            AdminMetadataManager metadataManager = new AdminMetadataManager(logContext,\n                config.getLong(AdminClientConfig.RETRY_BACKOFF_MS_CONFIG),\n                config.getLong(AdminClientConfig.METADATA_MAX_AGE_CONFIG),\n                adminAddresses.usingBootstrapControllers());",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java#L391-L540",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 391,
  "end_line": 540,
  "last_modified": "2026-02-06T01:16:27.585045",
  "source_type": "github"
}