{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_MetadataUpdater.java_1",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/MetadataUpdater.java",
  "content": "/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License. You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.apache.kafka.clients;\n\nimport org.apache.kafka.common.KafkaException;\nimport org.apache.kafka.common.Node;\nimport org.apache.kafka.common.errors.AuthenticationException;\nimport org.apache.kafka.common.errors.UnsupportedVersionException;\nimport org.apache.kafka.common.requests.MetadataResponse;\nimport org.apache.kafka.common.requests.RequestHeader;\n\nimport java.io.Closeable;\nimport java.util.List;\nimport java.util.Optional;\n\n/**\n * The interface used by `NetworkClient` to request cluster metadata info to be updated and to retrieve the cluster nodes\n * from such metadata. This is an internal class.\n * <p>\n * This class is not thread-safe!\n */\npublic interface MetadataUpdater extends Closeable {\n\n    /**\n     * Gets the current cluster info without blocking.\n     */\n    List<Node> fetchNodes();\n\n    /**\n     * Returns true if an update to the cluster metadata info is due.\n     */\n    boolean isUpdateDue(long now);\n\n    /**\n     * Starts a cluster metadata update if needed and possible. Returns the time until the metadata update (which would\n     * be 0 if an update has been started as a result of this call).\n     *\n     * If the implementation relies on `NetworkClient` to send requests, `handleSuccessfulResponse` will be\n     * invoked after the metadata response is received.\n     *\n     * The semantics of `needed` and `possible` are implementation-dependent and may take into account a number of\n     * factors like node availability, how long since the last metadata update, etc.\n     */\n    long maybeUpdate(long now);\n\n    /**\n     * Handle a server disconnect.\n     *\n     * This provides a mechanism for the `MetadataUpdater` implementation to use the NetworkClient instance for its own\n     * requests with special handling for disconnections of such requests.\n     *\n     * @param now Current time in milliseconds\n     * @param nodeId The id of the node that disconnected\n     * @param maybeAuthException Optional authentication error\n     */\n    void handleServerDisconnect(long now, String nodeId, Optional<AuthenticationException> maybeAuthException);\n\n    /**\n     * Handle a metadata request failure.\n     *\n     * @param now Current time in milliseconds\n     * @param maybeFatalException Optional fatal error (e.g. {@link UnsupportedVersionException})\n     */\n    void handleFailedRequest(long now, Optional<KafkaException> maybeFatalException);\n\n    /**\n     * Handle responses for metadata requests.\n     *\n     * This provides a mechanism for the `MetadataUpdater` implementation to use the NetworkClient instance for its own\n     * requests with special handling for completed receives of such requests.\n     */\n    void handleSuccessfulResponse(RequestHeader requestHeader, long now, MetadataResponse metadataResponse);\n\n    /**\n     * Returns true if metadata couldn't be fetched for `rebootstrapTriggerMs` or if server requested rebootstrap.\n     *\n     * @param now Current time in milliseconds\n     * @param rebootstrapTriggerMs Configured timeout after which rebootstrap is triggered\n     */\n    default boolean needsRebootstrap(long now, long rebootstrapTriggerMs) {\n        return false;\n    }\n\n    /**\n     * Performs rebootstrap, replacing the existing cluster with the bootstrap cluster.\n     *\n     * @param now Current time in milliseconds\n     */\n    default void rebootstrap(long now) {}\n\n    /**\n     * Close this updater.\n     */\n    @Override\n    void close();\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/MetadataUpdater.java#L1-L111",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/MetadataUpdater.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 1,
  "end_line": 111,
  "last_modified": "2026-02-06T01:16:27.578744",
  "source_type": "github"
}