{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_admin_KafkaAdminClient.java_4811",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java",
  "content": "    public DescribeProducersResult describeProducers(Collection<TopicPartition> topicPartitions, DescribeProducersOptions options) {\n        PartitionLeaderStrategy.PartitionLeaderFuture<DescribeProducersResult.PartitionProducerState> future =\n            DescribeProducersHandler.newFuture(topicPartitions, partitionLeaderCache);\n        DescribeProducersHandler handler = new DescribeProducersHandler(options, logContext);\n        invokeDriver(handler, future, options.timeoutMs);\n        return new DescribeProducersResult(future.all());\n    }\n\n    @Override\n    public DescribeTransactionsResult describeTransactions(Collection<String> transactionalIds, DescribeTransactionsOptions options) {\n        AdminApiFuture.SimpleAdminApiFuture<CoordinatorKey, TransactionDescription> future =\n            DescribeTransactionsHandler.newFuture(transactionalIds);\n        DescribeTransactionsHandler handler = new DescribeTransactionsHandler(logContext);\n        invokeDriver(handler, future, options.timeoutMs);\n        return new DescribeTransactionsResult(future.all());\n    }\n\n    @Override\n    public AbortTransactionResult abortTransaction(AbortTransactionSpec spec, AbortTransactionOptions options) {\n        PartitionLeaderStrategy.PartitionLeaderFuture<Void> future =\n            AbortTransactionHandler.newFuture(Collections.singleton(spec.topicPartition()), partitionLeaderCache);\n        AbortTransactionHandler handler = new AbortTransactionHandler(spec, logContext);\n        invokeDriver(handler, future, options.timeoutMs);\n        return new AbortTransactionResult(future.all());\n    }\n\n    /**\n     * Forcefully terminates an ongoing transaction for a given transactional ID.\n     * <p>\n     * This API is intended for well-formed but long-running transactions that are known to the\n     * transaction coordinator. It is primarily designed for supporting 2PC (two-phase commit) workflows,\n     * where a coordinator may need to unilaterally terminate a participant transaction that hasn't completed.\n     * </p>\n     *\n     * @param transactionalId The transactional ID whose active transaction should be forcefully terminated.\n     * @return a {@link TerminateTransactionResult} that can be used to await the operation result.\n     */\n    @Override\n    public TerminateTransactionResult forceTerminateTransaction(String transactionalId, TerminateTransactionOptions options) {\n        // Simply leverage the existing fenceProducers implementation with a single transactional ID\n        FenceProducersOptions fenceOptions = new FenceProducersOptions();\n        if (options.timeoutMs() != null) {\n            fenceOptions.timeoutMs(options.timeoutMs());\n        }\n\n        FenceProducersResult fenceResult = fenceProducers(\n            Collections.singleton(transactionalId),\n            fenceOptions\n        );\n\n        // Convert the result to a TerminateTransactionResult\n        KafkaFuture<Void> future = fenceResult.fencedProducers().get(transactionalId);\n        return new TerminateTransactionResult(future);\n    }\n\n    @Override\n    public ListTransactionsResult listTransactions(ListTransactionsOptions options) {\n        AllBrokersStrategy.AllBrokersFuture<Collection<TransactionListing>> future =\n            ListTransactionsHandler.newFuture();\n        ListTransactionsHandler handler = new ListTransactionsHandler(options, logContext);\n        invokeDriver(handler, future, options.timeoutMs);\n        return new ListTransactionsResult(future.all());\n    }\n\n    @Override\n    public FenceProducersResult fenceProducers(Collection<String> transactionalIds, FenceProducersOptions options) {\n        AdminApiFuture.SimpleAdminApiFuture<CoordinatorKey, ProducerIdAndEpoch> future =\n            FenceProducersHandler.newFuture(transactionalIds);\n        FenceProducersHandler handler = new FenceProducersHandler(options, logContext, requestTimeoutMs);\n        invokeDriver(handler, future, options.timeoutMs);\n        return new FenceProducersResult(future.all());\n    }\n\n    @Override\n    public ListConfigResourcesResult listConfigResources(Set<ConfigResource.Type> configResourceTypes, ListConfigResourcesOptions options) {\n        final long now = time.milliseconds();\n        final KafkaFutureImpl<Collection<ConfigResource>> future = new KafkaFutureImpl<>();\n        final Call call = new Call(\"listConfigResources\", calcDeadlineMs(now, options.timeoutMs()), new LeastLoadedNodeProvider()) {\n\n            @Override\n            ListConfigResourcesRequest.Builder createRequest(int timeoutMs) {\n                return new ListConfigResourcesRequest.Builder(\n                    new ListConfigResourcesRequestData()\n                        .setResourceTypes(\n                            configResourceTypes\n                                .stream()\n                                .map(ConfigResource.Type::id)\n                                .collect(Collectors.toList())\n                        )\n                );\n            }\n\n            @Override\n            void handleResponse(AbstractResponse abstractResponse) {\n                ListConfigResourcesResponse response = (ListConfigResourcesResponse) abstractResponse;\n                if (response.error().isFailure()) {\n                    future.completeExceptionally(response.error().exception());\n                } else {\n                    future.complete(response.configResources());\n                }\n            }\n\n            @Override\n            void handleFailure(Throwable throwable) {\n                future.completeExceptionally(throwable);\n            }\n        };\n        runnable.call(call, now);\n        return new ListConfigResourcesResult(future);\n    }\n\n    @SuppressWarnings({\"deprecation\", \"removal\"})\n    @Override\n    public ListClientMetricsResourcesResult listClientMetricsResources(ListClientMetricsResourcesOptions options) {\n        final long now = time.milliseconds();\n        final KafkaFutureImpl<Collection<ClientMetricsResourceListing>> future = new KafkaFutureImpl<>();\n        runnable.call(new Call(\"listClientMetricsResources\", calcDeadlineMs(now, options.timeoutMs()),\n            new LeastLoadedNodeProvider()) {\n\n            @Override\n            ListConfigResourcesRequest.Builder createRequest(int timeoutMs) {\n                return new ListConfigResourcesRequest.Builder(\n                    new ListConfigResourcesRequestData()\n                        .setResourceTypes(List.of(ConfigResource.Type.CLIENT_METRICS.id()))\n                );\n            }\n\n            @Override\n            void handleResponse(AbstractResponse abstractResponse) {\n                ListConfigResourcesResponse response = (ListConfigResourcesResponse) abstractResponse;\n                if (response.error().isFailure()) {\n                    future.completeExceptionally(response.error().exception());\n                } else {\n                    future.complete(response\n                        .data()\n                        .configResources()\n                        .stream()\n                        .filter(entry -> entry.resourceType() == ConfigResource.Type.CLIENT_METRICS.id())\n                        .map(entry -> new ClientMetricsResourceListing(entry.resourceName()))\n                        .collect(Collectors.toList()));\n                }\n            }\n\n            @Override\n            void handleFailure(Throwable throwable) {\n                future.completeExceptionally(throwable);\n            }\n        }, now);\n        return new ListClientMetricsResourcesResult(future);\n    }",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java#L4811-L4960",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 4811,
  "end_line": 4960,
  "last_modified": "2026-02-06T01:16:27.585045",
  "source_type": "github"
}