{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_producer_internals_BufferPool.java_261",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/producer/internals/BufferPool.java",
  "content": "        lock.lock();\n        try {\n            if (size == this.poolableSize && size == buffer.capacity()) {\n                buffer.clear();\n                this.free.add(buffer);\n            } else {\n                this.nonPooledAvailableMemory += size;\n            }\n            Condition moreMem = this.waiters.peekFirst();\n            if (moreMem != null)\n                moreMem.signal();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void deallocate(ByteBuffer buffer) {\n        if (buffer != null)\n            deallocate(buffer, buffer.capacity());\n    }\n\n    /**\n     * the total free memory both unallocated and in the free list\n     */\n    public long availableMemory() {\n        lock.lock();\n        try {\n            return this.nonPooledAvailableMemory + freeSize() * (long) this.poolableSize;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    // Protected for testing.\n    protected int freeSize() {\n        return this.free.size();\n    }\n\n    /**\n     * Get the unallocated memory (not in the free list or in use)\n     */\n    public long unallocatedMemory() {\n        lock.lock();\n        try {\n            return this.nonPooledAvailableMemory;\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * The number of threads blocked waiting on memory\n     */\n    public int queued() {\n        lock.lock();\n        try {\n            return this.waiters.size();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    /**\n     * The buffer size that will be retained in the free list after use\n     */\n    public int poolableSize() {\n        return this.poolableSize;\n    }\n\n    /**\n     * The total memory managed by this pool\n     */\n    public long totalMemory() {\n        return this.totalMemory;\n    }\n\n    // package-private method used only for testing\n    Deque<Condition> waiters() {\n        return this.waiters;\n    }\n\n    /**\n     * Closes the buffer pool. Memory will be prevented from being allocated, but may be deallocated. All allocations\n     * awaiting available memory will be notified to abort.\n     */\n    public void close() {\n        this.lock.lock();\n        this.closed = true;\n        try {\n            for (Condition waiter : this.waiters)\n                waiter.signal();\n        } finally {\n            this.lock.unlock();\n        }\n    }\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/internals/BufferPool.java#L261-L357",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/producer/internals/BufferPool.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 261,
  "end_line": 357,
  "last_modified": "2026-02-06T01:16:27.609128",
  "source_type": "github"
}