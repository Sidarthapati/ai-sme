{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_InFlightRequests.java_131",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/InFlightRequests.java",
  "content": "        for (Deque<NetworkClient.InFlightRequest> deque : this.requests.values()) {\n            if (!deque.isEmpty())\n                return false;\n        }\n        return true;\n    }\n\n    /**\n     * Clear out all the in-flight requests for the given node and return them\n     *\n     * @param node The node\n     * @return All the in-flight requests for that node that have been removed\n     */\n    public Iterable<NetworkClient.InFlightRequest> clearAll(String node) {\n        Deque<NetworkClient.InFlightRequest> reqs = requests.get(node);\n        if (reqs == null) {\n            return Collections.emptyList();\n        } else {\n            final Deque<NetworkClient.InFlightRequest> clearedRequests = requests.remove(node);\n            inFlightRequestCount.getAndAdd(-clearedRequests.size());\n            return clearedRequests::descendingIterator;\n        }\n    }\n\n    private Boolean hasExpiredRequest(long now, Deque<NetworkClient.InFlightRequest> deque) {\n        for (NetworkClient.InFlightRequest request : deque) {\n            // We exclude throttle time here because we want to ensure that we don't expire requests while\n            // they are throttled. The request timeout should take effect only after the throttle time has elapsed.\n            if (request.timeElapsedSinceSendMs(now) - request.throttleTimeMs() > request.requestTimeoutMs)\n                return true;\n        }\n        return false;\n    }\n\n    /**\n     * Returns a list of nodes with pending in-flight request, that need to be timed out\n     *\n     * @param now current time in milliseconds\n     * @return list of nodes\n     */\n    public List<String> nodesWithTimedOutRequests(long now) {\n        List<String> nodeIds = new ArrayList<>();\n        for (Map.Entry<String, Deque<NetworkClient.InFlightRequest>> requestEntry : requests.entrySet()) {\n            String nodeId = requestEntry.getKey();\n            Deque<NetworkClient.InFlightRequest> deque = requestEntry.getValue();\n            if (hasExpiredRequest(now, deque))\n                nodeIds.add(nodeId);\n        }\n        return nodeIds;\n    }\n\n    void incrementThrottleTime(String nodeId, long throttleTimeMs) {\n        requests.getOrDefault(nodeId, new ArrayDeque<>()).\n                forEach(request -> request.incrementThrottleTime(throttleTimeMs));\n    }\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/InFlightRequests.java#L131-L187",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/InFlightRequests.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 131,
  "end_line": 187,
  "last_modified": "2026-02-06T01:16:27.578181",
  "source_type": "github"
}