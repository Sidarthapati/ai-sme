{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_producer_KafkaProducer.java_1691",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java",
  "content": "            this.userCallback = userCallback;\n            this.interceptors = interceptors;\n            // Extract record info as we don't want to keep a reference to the record during\n            // whole lifetime of the batch.\n            // We don't want to have an NPE here, because the interceptors would not be notified (see .doSend).\n            topic = record != null ? record.topic() : null;\n            if (record != null) {\n                headers = record.headers();\n            } else {\n                headers = new RecordHeaders();\n                ((RecordHeaders) headers).setReadOnly();\n            }\n            recordPartition = record != null ? record.partition() : null;\n            recordLogString = log.isTraceEnabled() && record != null ? record.toString() : \"\";\n        }\n\n        @Override\n        public void onCompletion(RecordMetadata metadata, Exception exception) {\n            if (metadata == null) {\n                metadata = new RecordMetadata(topicPartition(), -1, -1, RecordBatch.NO_TIMESTAMP, -1, -1);\n            }\n            this.interceptors.onAcknowledgement(metadata, exception, headers);\n            if (this.userCallback != null)\n                this.userCallback.onCompletion(metadata, exception);\n        }\n\n        @Override\n        public void setPartition(int partition) {\n            assert partition != RecordMetadata.UNKNOWN_PARTITION;\n            this.partition = partition;\n\n            if (log.isTraceEnabled()) {\n                // Log the message here, because we don't know the partition before that.\n                log.trace(\"Attempting to append record {} with callback {} to topic {} partition {}\", recordLogString, userCallback, topic, partition);\n            }\n        }\n\n        public int getPartition() {\n            return partition;\n        }\n\n        public TopicPartition topicPartition() {\n            if (topicPartition == null && topic != null) {\n                if (partition != RecordMetadata.UNKNOWN_PARTITION)\n                    topicPartition = new TopicPartition(topic, partition);\n                else if (recordPartition != null)\n                    topicPartition = new TopicPartition(topic, recordPartition);\n                else\n                    topicPartition = new TopicPartition(topic, RecordMetadata.UNKNOWN_PARTITION);\n            }\n            return topicPartition;\n        }\n    }\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java#L1691-L1745",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 1691,
  "end_line": 1745,
  "last_modified": "2026-02-06T01:16:27.608270",
  "source_type": "github"
}