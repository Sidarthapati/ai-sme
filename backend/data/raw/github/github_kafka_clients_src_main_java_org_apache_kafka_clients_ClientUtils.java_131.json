{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_ClientUtils.java_131",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/ClientUtils.java",
  "content": "\n    /**\n     * Return a list containing the first address in `allAddresses` and subsequent addresses\n     * that are a subtype of the first address.\n     *\n     * The outcome is that all returned addresses are either IPv4 or IPv6 (InetAddress has two\n     * subclasses: Inet4Address and Inet6Address).\n     */\n    static List<InetAddress> filterPreferredAddresses(InetAddress[] allAddresses) {\n        List<InetAddress> preferredAddresses = new ArrayList<>();\n        Class<? extends InetAddress> clazz = null;\n        for (InetAddress address : allAddresses) {\n            if (clazz == null) {\n                clazz = address.getClass();\n            }\n            if (clazz.isInstance(address)) {\n                preferredAddresses.add(address);\n            }\n        }\n        return preferredAddresses;\n    }\n\n    public static NetworkClient createNetworkClient(AbstractConfig config,\n                                                    Metrics metrics,\n                                                    String metricsGroupPrefix,\n                                                    LogContext logContext,\n                                                    ApiVersions apiVersions,\n                                                    Time time,\n                                                    int maxInFlightRequestsPerConnection,\n                                                    Metadata metadata,\n                                                    Sensor throttleTimeSensor,\n                                                    ClientTelemetrySender clientTelemetrySender) {\n        return createNetworkClient(config,\n                config.getString(CommonClientConfigs.CLIENT_ID_CONFIG),\n                metrics,\n                metricsGroupPrefix,\n                logContext,\n                apiVersions,\n                time,\n                maxInFlightRequestsPerConnection,\n                config.getInt(CommonClientConfigs.REQUEST_TIMEOUT_MS_CONFIG),\n                metadata,\n                null,\n                new DefaultHostResolver(),\n                throttleTimeSensor,\n                clientTelemetrySender);\n    }\n\n    public static NetworkClient createNetworkClient(AbstractConfig config,\n                                                    String clientId,\n                                                    Metrics metrics,\n                                                    String metricsGroupPrefix,\n                                                    LogContext logContext,\n                                                    ApiVersions apiVersions,\n                                                    Time time,\n                                                    int maxInFlightRequestsPerConnection,\n                                                    int requestTimeoutMs,\n                                                    MetadataUpdater metadataUpdater,\n                                                    HostResolver hostResolver) {\n        return createNetworkClient(config,\n                clientId,\n                metrics,\n                metricsGroupPrefix,\n                logContext,\n                apiVersions,\n                time,\n                maxInFlightRequestsPerConnection,\n                requestTimeoutMs,\n                null,\n                metadataUpdater,\n                hostResolver,\n                null,\n                null);\n    }\n\n    public static NetworkClient createNetworkClient(AbstractConfig config,\n                                                    String clientId,\n                                                    Metrics metrics,\n                                                    String metricsGroupPrefix,\n                                                    LogContext logContext,\n                                                    ApiVersions apiVersions,\n                                                    Time time,\n                                                    int maxInFlightRequestsPerConnection,\n                                                    int requestTimeoutMs,\n                                                    Metadata metadata,\n                                                    MetadataUpdater metadataUpdater,\n                                                    HostResolver hostResolver,\n                                                    Sensor throttleTimeSensor,\n                                                    ClientTelemetrySender clientTelemetrySender) {\n        ChannelBuilder channelBuilder = null;\n        Selector selector = null;\n\n        try {\n            channelBuilder = ClientUtils.createChannelBuilder(config, time, logContext);\n            selector = new Selector(config.getLong(CommonClientConfigs.CONNECTIONS_MAX_IDLE_MS_CONFIG),\n                    metrics,\n                    time,\n                    metricsGroupPrefix,\n                    channelBuilder,\n                    logContext);\n            return new NetworkClient(metadataUpdater,\n                    metadata,\n                    selector,\n                    clientId,\n                    maxInFlightRequestsPerConnection,\n                    config.getLong(CommonClientConfigs.RECONNECT_BACKOFF_MS_CONFIG),\n                    config.getLong(CommonClientConfigs.RECONNECT_BACKOFF_MAX_MS_CONFIG),\n                    config.getInt(CommonClientConfigs.SEND_BUFFER_CONFIG),\n                    config.getInt(CommonClientConfigs.RECEIVE_BUFFER_CONFIG),\n                    requestTimeoutMs,\n                    config.getLong(CommonClientConfigs.SOCKET_CONNECTION_SETUP_TIMEOUT_MS_CONFIG),\n                    config.getLong(CommonClientConfigs.SOCKET_CONNECTION_SETUP_TIMEOUT_MAX_MS_CONFIG),\n                    time,\n                    true,\n                    apiVersions,\n                    throttleTimeSensor,\n                    logContext,\n                    hostResolver,\n                    clientTelemetrySender,\n                    config.getLong(CommonClientConfigs.METADATA_RECOVERY_REBOOTSTRAP_TRIGGER_MS_CONFIG),\n                    MetadataRecoveryStrategy.forName(config.getString(CommonClientConfigs.METADATA_RECOVERY_STRATEGY_CONFIG))\n            );\n        } catch (Throwable t) {\n            closeQuietly(selector, \"Selector\");\n            closeQuietly(channelBuilder, \"ChannelBuilder\");\n            throw new KafkaException(\"Failed to create new NetworkClient\", t);\n        }\n    }\n\n    public static <T> List<?> configuredInterceptors(AbstractConfig config,\n                                                    String interceptorClassesConfigName,\n                                                    Class<T> clazz) {\n        String clientId = config.getString(CommonClientConfigs.CLIENT_ID_CONFIG);\n        return config.getConfiguredInstances(\n                interceptorClassesConfigName,\n                clazz,\n                Collections.singletonMap(CommonClientConfigs.CLIENT_ID_CONFIG, clientId));\n    }\n\n    public static ClusterResourceListeners configureClusterResourceListeners(List<?>... candidateLists) {\n        ClusterResourceListeners clusterResourceListeners = new ClusterResourceListeners();\n\n        for (List<?> candidateList: candidateLists)\n            clusterResourceListeners.maybeAddAll(candidateList);\n\n        return clusterResourceListeners;\n    }\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/ClientUtils.java#L131-L279",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/ClientUtils.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 131,
  "end_line": 279,
  "last_modified": "2026-02-06T01:16:27.577378",
  "source_type": "github"
}