{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_admin_DescribeUserScramCredentialsResult.java_1",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/admin/DescribeUserScramCredentialsResult.java",
  "content": "/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License. You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage org.apache.kafka.clients.admin;\n\nimport org.apache.kafka.common.KafkaFuture;\nimport org.apache.kafka.common.errors.ResourceNotFoundException;\nimport org.apache.kafka.common.internals.KafkaFutureImpl;\nimport org.apache.kafka.common.message.DescribeUserScramCredentialsResponseData;\nimport org.apache.kafka.common.protocol.Errors;\n\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Objects;\nimport java.util.Optional;\nimport java.util.stream.Collectors;\n\n/**\n * The result of the {@link Admin#describeUserScramCredentials()} call.\n */\npublic class DescribeUserScramCredentialsResult {\n    private final KafkaFuture<DescribeUserScramCredentialsResponseData> dataFuture;\n\n    /**\n     * Package-private constructor\n     *\n     * @param dataFuture the future indicating response data from the call\n     */\n    DescribeUserScramCredentialsResult(KafkaFuture<DescribeUserScramCredentialsResponseData> dataFuture) {\n        this.dataFuture = Objects.requireNonNull(dataFuture);\n    }\n\n    /**\n     *\n     * @return a future for the results of all described users with map keys (one per user) being consistent with the\n     * contents of the list returned by {@link #users()}. The future will complete successfully only if all such user\n     * descriptions complete successfully.\n     */\n    public KafkaFuture<Map<String, UserScramCredentialsDescription>> all() {\n        final KafkaFutureImpl<Map<String, UserScramCredentialsDescription>> retval = new KafkaFutureImpl<>();\n        dataFuture.whenComplete((data, throwable) -> {\n            if (throwable != null) {\n                retval.completeExceptionally(throwable);\n            } else {\n                /* Check to make sure every individual described user succeeded.  Note that a successfully described user\n                 * is one that appears with *either* a NONE error code or a RESOURCE_NOT_FOUND error code. The\n                 * RESOURCE_NOT_FOUND means the client explicitly requested a describe of that particular user but it could\n                 * not be described because it does not exist; such a user will not appear as a key in the returned map.\n                 */\n                Optional<DescribeUserScramCredentialsResponseData.DescribeUserScramCredentialsResult> optionalFirstFailedDescribe =\n                        data.results().stream().filter(result ->\n                                result.errorCode() != Errors.NONE.code() && result.errorCode() != Errors.RESOURCE_NOT_FOUND.code()).findFirst();\n                if (optionalFirstFailedDescribe.isPresent()) {\n                    retval.completeExceptionally(Errors.forCode(optionalFirstFailedDescribe.get().errorCode()).exception(optionalFirstFailedDescribe.get().errorMessage()));\n                } else {\n                    Map<String, UserScramCredentialsDescription> retvalMap = new HashMap<>();\n                    data.results().forEach(userResult ->\n                            retvalMap.put(userResult.user(), new UserScramCredentialsDescription(userResult.user(),\n                                    getScramCredentialInfosFor(userResult))));\n                    retval.complete(retvalMap);\n                }\n            }\n        });\n        return retval;\n    }\n\n    /**\n     *\n     * @return a future indicating the distinct users that meet the request criteria and that have at least one\n     * credential.  The future will not complete successfully if the user is not authorized to perform the describe\n     * operation; otherwise, it will complete successfully as long as the list of users with credentials can be\n     * successfully determined within some hard-coded timeout period. Note that the returned list will not include users\n     * that do not exist/have no credentials: a request to describe an explicit list of users, none of which existed/had\n     * a credential, will result in a future that returns an empty list being returned here. A returned list will\n     * include users that have a credential but that could not be described.\n     */\n    public KafkaFuture<List<String>> users() {\n        final KafkaFutureImpl<List<String>> retval = new KafkaFutureImpl<>();\n        dataFuture.whenComplete((data, throwable) -> {\n            if (throwable != null) {\n                retval.completeExceptionally(throwable);\n            } else {\n                retval.complete(data.results().stream()\n                        .filter(result -> result.errorCode() != Errors.RESOURCE_NOT_FOUND.code())\n                        .map(result -> result.user()).collect(Collectors.toList()));\n            }\n        });\n        return retval;\n    }\n\n    /**\n     *\n     * @param userName the name of the user description being requested\n     * @return a future indicating the description results for the given user. The future will complete exceptionally if\n     * the future returned by {@link #users()} completes exceptionally.  Note that if the given user does not exist in\n     * the list of described users then the returned future will complete exceptionally with\n     * {@link org.apache.kafka.common.errors.ResourceNotFoundException}.\n     */\n    public KafkaFuture<UserScramCredentialsDescription> description(String userName) {\n        final KafkaFutureImpl<UserScramCredentialsDescription> retval = new KafkaFutureImpl<>();\n        dataFuture.whenComplete((data, throwable) -> {\n            if (throwable != null) {\n                retval.completeExceptionally(throwable);\n            } else {\n                // it is possible that there is no future for this user (for example, the original describe request was\n                // for users 1, 2, and 3 but this is looking for user 4), so explicitly take care of that case\n                Optional<DescribeUserScramCredentialsResponseData.DescribeUserScramCredentialsResult> optionalUserResult =\n                        data.results().stream().filter(result -> result.user().equals(userName)).findFirst();\n                if (optionalUserResult.isEmpty()) {\n                    retval.completeExceptionally(new ResourceNotFoundException(\"No such user: \" + userName));\n                } else {\n                    DescribeUserScramCredentialsResponseData.DescribeUserScramCredentialsResult userResult = optionalUserResult.get();\n                    if (userResult.errorCode() != Errors.NONE.code()) {\n                        // RESOURCE_NOT_FOUND is included here\n                        retval.completeExceptionally(Errors.forCode(userResult.errorCode()).exception(userResult.errorMessage()));\n                    } else {\n                        retval.complete(new UserScramCredentialsDescription(userResult.user(), getScramCredentialInfosFor(userResult)));\n                    }\n                }\n            }\n        });\n        return retval;\n    }\n\n    private static List<ScramCredentialInfo> getScramCredentialInfosFor(\n            DescribeUserScramCredentialsResponseData.DescribeUserScramCredentialsResult userResult) {\n        return userResult.credentialInfos().stream().map(c ->\n                new ScramCredentialInfo(ScramMechanism.fromType(c.mechanism()), c.iterations()))\n                .collect(Collectors.toList());\n    }\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/admin/DescribeUserScramCredentialsResult.java#L1-L147",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/admin/DescribeUserScramCredentialsResult.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 1,
  "end_line": 147,
  "last_modified": "2026-02-06T01:16:27.583970",
  "source_type": "github"
}