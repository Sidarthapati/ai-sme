{
  "id": "kafka_clients_src_main_java_org_apache_kafka_clients_producer_PreparedTxnState.java_1",
  "title": "kafka/clients/src/main/java/org/apache/kafka/clients/producer/PreparedTxnState.java",
  "content": "/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License. You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.apache.kafka.clients.producer;\n\nimport org.apache.kafka.common.record.RecordBatch;\n\n/**\n * Class containing the state of a transaction after it has been prepared for a two-phase commit.\n * This state includes the producer ID and epoch, which are needed to commit or abort the transaction.\n */\npublic class PreparedTxnState {\n    private final long producerId;\n    private final short epoch;\n\n    /**\n     * Creates a new empty PreparedTxnState\n     */\n    public PreparedTxnState() {\n        this.producerId = RecordBatch.NO_PRODUCER_ID;\n        this.epoch = RecordBatch.NO_PRODUCER_EPOCH;\n    }\n\n    /**\n     * Creates a new PreparedTxnState from a serialized string representation\n     *\n     * @param serializedState               The serialized string to deserialize.\n     * @throws IllegalArgumentException if the serialized string is not in the expected format\n     */\n    public PreparedTxnState(String serializedState) {\n        if (serializedState == null || serializedState.isEmpty()) {\n            this.producerId = RecordBatch.NO_PRODUCER_ID;\n            this.epoch = RecordBatch.NO_PRODUCER_EPOCH;\n            return;\n        }\n\n        try {\n            String[] parts = serializedState.split(\":\");\n            if (parts.length != 2) {\n                throw new IllegalArgumentException(\"Invalid serialized transaction state format: \" + serializedState);\n            }\n\n            this.producerId = Long.parseLong(parts[0]);\n            this.epoch = Short.parseShort(parts[1]);\n\n            // Validate the producerId and epoch values.\n            if (!(this.producerId >= 0 && this.epoch >= 0)) {\n                throw new IllegalArgumentException(\"Invalid producer ID and epoch values: \" +\n                    producerId + \":\" + epoch + \". Both must be >= 0\");\n            }\n        } catch (NumberFormatException e) {\n            throw new IllegalArgumentException(\"Invalid serialized transaction state format: \" + serializedState, e);\n        }\n    }\n\n    /**\n     * Creates a new PreparedTxnState with the given producer ID and epoch\n     *\n     * @param producerId        The producer ID\n     * @param epoch             The producer epoch\n     */\n    PreparedTxnState(long producerId, short epoch) {\n        this.producerId = producerId;\n        this.epoch = epoch;\n    }\n\n    public long producerId() {\n        return producerId;\n    }\n\n    public short epoch() {\n        return epoch;\n    }\n\n    /**\n     * Checks if this preparedTxnState represents an initialized transaction with a valid producer ID\n     * that is not -1 (the uninitialized value).\n     *\n     * @return true if the state has an initialized transaction, false otherwise.\n     */\n    public boolean hasTransaction() {\n        return producerId != RecordBatch.NO_PRODUCER_ID;\n    }\n\n    /**\n     * Returns a serialized string representation of this transaction state.\n     * The format is \"producerId:epoch\" for an initialized state, or an empty string\n     * for an uninitialized state (where producerId and epoch are both -1).\n     *\n     * @return a serialized string representation\n     */\n    @Override\n    public String toString() {\n        if (!hasTransaction()) {\n            return \"\";\n        }\n        return producerId + \":\" + epoch;\n    }\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (o == null || getClass() != o.getClass()) return false;\n        PreparedTxnState that = (PreparedTxnState) o;\n        return producerId == that.producerId && epoch == that.epoch;\n    }\n\n    @Override\n    public int hashCode() {\n        int result = 31;\n        result = 31 * result + Long.hashCode(producerId);\n        result = 31 * result + (int) epoch;\n        return result;\n    }\n}\n",
  "url": "https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/PreparedTxnState.java#L1-L129",
  "file_path": "clients/src/main/java/org/apache/kafka/clients/producer/PreparedTxnState.java",
  "repo_name": "kafka",
  "language": "java",
  "start_line": 1,
  "end_line": 129,
  "last_modified": "2026-02-06T01:16:27.608510",
  "source_type": "github"
}